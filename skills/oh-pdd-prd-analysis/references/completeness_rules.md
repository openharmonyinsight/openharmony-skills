# PRD 完整性检查规则

本文档定义 HM Desktop PRD 文档的完整性验证规则。

## 章节完整性矩阵

| 章节 | 必需 | 必需子章节 | 验证标准 |
|------|------|-----------|----------|
| 产品概述 | ✅ 是 | 3（定位、用户、价值） | 所有子章节存在且有内容 |
| 用户故事 | ✅ 是 | 3（角色、场景、流程） | 所有子章节存在且有内容 |
| KEP定义 | ✅ 是 | ≥3 个KEP | 每个KEP有ID、名称、优先级、故事、标准 |
| 功能规格 | ✅ 是 | ≥KEP数量 | 每个功能有描述、输入、输出、约束 |
| 验收标准 | ✅ 是 | 每个功能 | 每个功能有可测试的验收标准 |
| 非功能需求 | ✅ 是 | 3（性能、安全、兼容） | 所有子章节存在 |
| 依赖关系 | ⚠️ 推荐 | - | 如适用则列出 |
| 风险评估 | ⚠️ 推荐 | - | 如适用则列出 |

## 详细验证规则

### 1. 产品概述

#### 1.1 产品定位

**必需内容**：
- 清晰说明功能是什么
- 如何融入整体产品
- 解决什么问题

**验证**：
- [ ] 包含清晰的产品定义
- [ ] 说明解决的问题
- [ ] 定位具体（不模糊）

#### 1.2 目标用户

**必需内容**：
- 用户角色定义
- 用户特征
- 用户场景/上下文

**验证**：
- [ ] 至少定义了一个用户角色
- [ ] 用户角色有清晰特征
- [ ] 目标用户群体可识别

#### 1.3 核心价值

**必需内容**：
- 价值主张声明
- 用户利益
- 与替代方案的差异化

**验证**：
- [ ] 价值清晰表达
- [ ] 利益以用户为中心
- [ ] 差异化已说明

### 2. 用户故事

#### 2.1 角色定义

**必需内容**：
- 所有用户角色列表
- 每个角色的描述
- 角色权限/限制

**验证**：
- [ ] 列出所有用户角色
- [ ] 每个角色有描述
- [ ] 角色层次清晰（如适用）

#### 2.2 使用场景

**必需内容**：
- 每个角色至少一个场景
- 场景上下文（何时/何地/为何）
- 预期结果

**验证**：
- [ ] 每个角色至少有一个场景
- [ ] 场景有清晰上下文
- [ ] 说明预期结果

#### 2.3 操作流程

**必需内容**：
- 分步操作描述
- 决策点
- 错误处理

**验证**：
- [ ] 流程有清晰步骤
- [ ] 步骤逻辑有序
- [ ] 处理错误条件

### 3. KEP定义

#### KEP 完整性

**必需内容**：
- KEP ID（有效格式）
- KEP 名称（动词优先、简洁）
- 优先级（P0/P1/P2）
- 用户故事
- 验收标准（≥2个、可测量）

**验证**：
- [ ] KEP ID 格式正确
- [ ] KEP 名称遵循规范
- [ ] 优先级明确指定
- [ ] 用户故事完整
- [ ] 验收标准可测量

#### KEP 数量要求

| 项目类型 | 最少KEP | 推荐P0 KEP |
|----------|---------|-----------|
| 主要功能 | 4-6 | 2-3 |
| 次要功能 | 2-3 | 1-2 |
| 增强功能 | 1-2 | 1 |

### 4. 功能规格

#### 功能定义

**必需内容**：
- 功能描述
- 输入参数
- 输出/返回值
- 约束/限制

**验证**：
- [ ] 功能有描述
- [ ] 指定输入（如不适用则为"无"）
- [ ] 指定输出
- [ ] 列出约束

#### 功能到KEP映射

**必需内容**：
- 每个功能必须映射到至少一个 KEP
- 每个 KEP 必须有至少一个功能

**验证**：
- [ ] 所有功能都有 KEP 引用
- [ ] 所有 KEP 都有对应功能
- [ ] 映射一致

### 5. 验收标准

#### 标准质量

**必需内容**：
- 可测量条件
- 测试场景
- 边界情况覆盖

**验证**：
- [ ] 标准明确（不模糊）
- [ ] 标准可测量
- [ ] 标准可测试
- [ ] 考虑边界情况

### 6. 非功能需求

#### 6.1 性能指标

**必需内容**：
- 响应时间要求
- 吞吐量要求
- 资源使用限制

**验证**：
- [ ] 至少指定一个性能指标
- [ ] 指标有目标值
- [ ] 指标可测量

**性能指标示例**：
- 响应时间：<100ms（p95）
- 吞吐量：>1000次/秒
- 内存：每实例<50MB
- CPU：<30% 平均值

#### 6.2 安全性

**必需内容**：
- 权限要求
- 数据保护
- 安全考虑

**验证**：
- [ ] 列出所需权限
- [ ] 描述数据处理
- [ ] 处理安全风险

#### 6.3 兼容性

**必需内容**：
- 系统版本要求
- 硬件要求
- 向后兼容性

**验证**：
- [ ] 指定目标系统版本
- [ ] 列出硬件要求
- [ ] 定义兼容性方法

## 完整性评分

### 分数计算

为每个章节分配分数：

- **2分**：完整包含所有必需内容
- **1分**：部分完整（缺少部分必需内容）
- **0分**：缺失或严重不完整

### 总分

```
总分 = 所有章节分数之和
最高分 = 12分（6个章节 × 2分）
```

### 完整性等级

| 分数范围 | 等级 | 说明 |
|----------|------|------|
| 11-12 | 优秀 | 所有必需内容都存在 |
| 9-10 | 良好 | 少量缺口，可接受 |
| 7-8 | 一般 | 明显缺口，需要完善 |
| 0-6 | 差 | 主要缺口，需要修订 |

## 常见完整性问题

### 问题 1：缺少非功能需求

**问题**：未指定性能、安全或兼容性

**影响**：无法验证实现是否满足要求

**修复**：添加具体的、可测量的非功能需求

### 问题 2：验收标准模糊

**问题**："快速响应"等标准没有具体值

**影响**：无法确定是否满足要求

**修复**：使用具体的、可测量的值

### 问题 3：用户故事不完整

**问题**：用户故事缺少角色、操作或目的

**影响**：用户需求不明确

**修复**：使用完整的用户故事模板："作为[角色]，我想要[操作]，以便[目的]"

### 问题 4：KEP 没有功能

**问题**：定义了 KEP 但没有对应的功能规格

**影响**：无法实现 KEP

**修复**：为每个 KEP 添加功能规格

## 验证检查清单

使用此清单验证 PRD 完整性：

```
头部
[ ] 文档标题遵循格式
[ ] 版本表存在
[ ] 版本号与文件名匹配

内容章节
[ ] 产品概述 - 所有3个子章节存在
[ ] 用户故事 - 所有3个子章节存在
[ ] KEP定义 - 至少3个KEP，所有字段完整
[ ] 功能规格 - 所有KEP都有功能定义
[ ] 验收标准 - 所有功能都有可测试标准
[ ] 非功能需求 - 所有3个子章节存在

质量检查
[ ] 没有模糊需求
[ ] 没有循环引用
[ ] 没有矛盾陈述
[ ] 所有引用可解析
[ ] 所有KEP都有功能
[ ] 所有功能都有KEP
```

## 自动验证命令

### 使用 grep 检查必需章节

```bash
# 检查必需章节标题
grep -E "^#{1,2} (产品概述|用户故事|关键体验路径|功能规格|验收标准|非功能需求)" prd.md

# 检查 KEP 定义
grep -E "KEP[0-9]+-[0-9]+" prd.md

# 检查优先级标记
grep -E "P[0-2]" prd.md
```

### 使用 markdown 解析器

```python
import re

def validate_prd(prd_file):
    with open(prd_file, 'r', encoding='utf-8') as f:
        content = f.read()

    required_sections = [
        "产品概述", "用户故事", "关键体验路径",
        "功能规格", "验收标准", "非功能需求"
    ]

    missing = []
    for section in required_sections:
        if section not in content:
            missing.append(section)

    return missing
```
